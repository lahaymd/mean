language: node_js
node_js:
  - "7"
dist: trusty
services:
  mongodb
addons:
  chrome: beta
  apt:
    sources:
      - google-chrome
    packages:
      - google-chrome-stable
before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 10 # give xvfb some time to start
  - npm install
  # - npm install protractor -g 
  -  ./node_modules/protractor/bin/webdriver-manager update
  - ./node_modules/protractor/bin/webdriver-manager start > /dev/null 2>&1 &
  # -  ./node_modules/protractor/bin/webdriver-manager start &
  # - webdriver-manager update 
  # - webdriver-manager start &
  # - gulp &
  - npm start &
  - sleep 10
before_install:
  # - # start your web application and listen on `localhost`
  - "/Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome --headless --disable-gpu --remote-debugging-port=9222 http://localhost &"

# script:
#   - npm test
deploy:
  provider: heroku
  api_key:
    secure: f95a7c82-61b3-4de7-9b80-6ff88e982f31